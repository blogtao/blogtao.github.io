
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>MQTT 笔记 - 郭工笔记</title>
    <!--  <meta name="robots" content="nofollow" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="郭工">
    

    
    <meta name="description" content="介绍  MQTT stands for MQ Telemetry Transport. It is a publish/subscribe, extremely simple and lightweight messaging protocol, designed for constrained devices and low-bandwidth, high-latency or unreliab">
<meta name="keywords" content="mqtt">
<meta property="og:type" content="article">
<meta property="og:title" content="MQTT 笔记">
<meta property="og:url" content="https://blog.devhitao.com/2017/09/25/mqtt-iot/index.html">
<meta property="og:site_name" content="郭工笔记">
<meta property="og:description" content="介绍  MQTT stands for MQ Telemetry Transport. It is a publish/subscribe, extremely simple and lightweight messaging protocol, designed for constrained devices and low-bandwidth, high-latency or unreliab">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-03-19T03:41:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MQTT 笔记">
<meta name="twitter:description" content="介绍  MQTT stands for MQ Telemetry Transport. It is a publish/subscribe, extremely simple and lightweight messaging protocol, designed for constrained devices and low-bandwidth, high-latency or unreliab">

    
    <link rel="alternative" href="/atom.xml" title="郭工笔记" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.png">
    
    
    <link rel="stylesheet" href="/css/style.css">
<!-- </script> -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-5819327586326271",
        enable_page_level_ads: true
      });
    </script>
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="郭工笔记">郭工笔记</a></h1>
				<h2 class="blog-motto">业精于勤，荒于嬉；行成于思，毁于随。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:blog.devhitao.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/25/mqtt-iot/" title="MQTT 笔记" itemprop="url">MQTT 笔记</a>
  </h1>
  
  <p class="article-time">
    <time datetime="2017-09-25T12:12:54.000Z" itemprop="datePublished"> 发表于 2017-09-25</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#介绍"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FQA"><span class="toc-number">2.</span> <span class="toc-text">FQA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MQTT-iOS-类库"><span class="toc-number">3.</span> <span class="toc-text">MQTT iOS 类库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-number">4.</span> <span class="toc-text">参考链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文档信息"><span class="toc-number">5.</span> <span class="toc-text">文档信息</span></a></li></ol>
		
		</div>
		
		<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><hr>
<blockquote>
<p>MQTT stands for MQ Telemetry Transport. It is a publish/subscribe, extremely simple and lightweight messaging protocol, designed for constrained devices and low-bandwidth, high-latency or unreliable networks. The design principles are to minimise network bandwidth and device resource requirements whilst also attempting to ensure reliability and some degree of assurance of delivery. These principles also turn out to make the protocol ideal of the emerging “machine-to-machine” (M2M) or “Internet of Things” world of connected devices, and for mobile applications where bandwidth and battery power are at a premium.</p>
</blockquote>
<blockquote>
<p>MQTT(Message Queuing Telemetry Transport，消息队列遥测传输)是一个 C/S 架构的发布/订阅模式的消息传输协议。它的设计思想是轻巧、开放、简单、规范、易于实现。可以把所有联网物品和外部连接起来，特别适用于受限的环境，如机器与机器（M2M）以及物联网环境（IoT）。</p>
</blockquote>
<p>协议特点包括：</p>
<ul>
<li>使用发布/订阅消息模式，提供一对多消息分发，接触应用之间耦合</li>
<li>对负载内容屏蔽的消息传输</li>
<li>使用 TCP/IP 提供基础网络连接</li>
<li>有三种级别（QoS0:最多分发一次、QoS1:至少达到一次、QoS2:仅分发一次）的消息传递服务</li>
<li>小型传输，开销很小（固定长度的头部2字节），协议交换最小化，以降低网络流量</li>
</ul>
<p>cleanSession</p>
<p>cleanSession 标志是 MQTT 协议中对一个客户端建立 TCP 连接后是否关心之前状态的定义。具体语义如下：</p>
<p>cleanSession=true：客户端再次上线时，将不再关心之前所有的订阅关系以及离线消息。<br>cleanSession=false：客户端再次上线时，还需要处理之前的离线消息，而之前的订阅关系也会持续生效。</p>
<p>注意：</p>
<p>MQTT 要求每个客户端每次连接时的 cleanSession 标志必须固定，不允许动态变化，否则会导致离线消息的判断有误。<br>MQTT 目前对外 QoS2 消息不支持非 cleanSession ，如果客户端以 QoS2 方式订阅消息，即使设置 cleanSession=false 也不会生效。<br>P2P 消息的 cleanSession 判断以发送方客户端的配置为准。</p>
<p>表格比较</p>
<p>通配符</p>
<ul>
<li>#:表示匹配 &gt;=0 个层次，比如 a/#, a/, a/b, a/b/c。单独的一个#表示匹配所有。</li>
<li>+:表示匹配一个层次，比如a/+, a/c, 不匹配 a/b/c。单独的一个+是允许的。</li>
</ul>
<p>注意：通配符只可用在主题过滤器中，在发布消息时，主题名字中不允许包含通配符。</p>
<p><a href="https://github.com/blogtao/mqtt-ios" target="_blank" rel="noopener">部分代码-后期有时间不断完善</a></p>
<p>iOS建议使用 <a href="https://github.com/novastone-media/MQTT-Client-Framework" target="_blank" rel="noopener">novastone-media/MQTT-Client-Framework</a> 类库</p>
<h3 id="FQA"><a href="#FQA" class="headerlink" title="FQA"></a>FQA</h3><hr>
<p>如何处理网络断开、上线和下线情况<br>1、网络断开，自动断开，无需处理。上线和下线调用API方法。</p>
<h3 id="MQTT-iOS-类库"><a href="#MQTT-iOS-类库" class="headerlink" title="MQTT iOS 类库"></a>MQTT iOS 类库</h3><hr>
<ul>
<li><a href="https://github.com/novastone-media/MQTT-Client-Framework" target="_blank" rel="noopener">novastone-media/MQTT-Client-Framework</a></li>
<li><a href="https://github.com/emqtt/CocoaMQTT" target="_blank" rel="noopener">emqtt/CocoaMQTT</a></li>
<li><a href="https://github.com/mobile-web-messaging/MQTTKit" target="_blank" rel="noopener">mobile-web-messaging/MQTTKit</a></li>
<li><a href="https://github.com/aciidb0mb3r/SwiftMQTT" target="_blank" rel="noopener">aciidb0mb3r/SwiftMQTT</a></li>
<li><a href="https://github.com/flightonary/Moscapsule" target="_blank" rel="noopener">flightonary/Moscapsule</a></li>
</ul>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><hr>
<ul>
<li><a href="http://mqtt.org/faq" target="_blank" rel="noopener">MQTT</a></li>
<li><a href="https://github.com/mcxiaoke/mqtt" target="_blank" rel="noopener">MQTT协议中文版</a></li>
<li><a href="https://github.com/hobbyquaker/awesome-mqtt#community-resources" target="_blank" rel="noopener">hobbyquaker/awesome-mqtt</a></li>
<li><a href="https://www.jianshu.com/p/bcf0251dc181" target="_blank" rel="noopener">ios MQTT协议及通讯的解决方案</a></li>
<li><a href="https://helpcdn.aliyun.com/document_detail/50069.html?spm=a2c4g.11186623.6.628.dtm3HS" target="_blank" rel="noopener">获取客户端上下线事件</a></li>
<li><a href="https://helpcdn.aliyun.com/document_detail/47755.html?spm=a2c4g.11186623.6.648.vbaSH4" target="_blank" rel="noopener">MQTT iOS 接入文档</a></li>
</ul>
<h3 id="文档信息"><a href="#文档信息" class="headerlink" title="文档信息"></a>文档信息</h3><hr>
<ul>
<li>版权声明：自由转载-保持署名-非商用-非衍生 ( <a rel="noopener" href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> )</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/mqtt/">mqtt</a>
  </div>

</div>

	<div class="article-share" id="share">
	
	  <div data-url="https://blog.devhitao.com/2017/09/25/mqtt-iot/" data-title="MQTT 笔记 | 郭工笔记" data-tsina="undefined" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/10/10/jekyll-usage/" title="Jekyll 安装和使用">
  <strong>上一篇：</strong><br/>
  <span>
  Jekyll 安装和使用</span>
</a>
</div>


<div class="next">
<a href="/2017/08/06/target-libraries-libcrypto-and-libssl-conflict/"  title="解决 libssl 和 libcrypto 类似冲突">
 <strong>下一篇：</strong><br/> 
 <span>解决 libssl 和 libcrypto 类似冲突
</span>
</a>
</div>

</nav>

	


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#介绍"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FQA"><span class="toc-number">2.</span> <span class="toc-text">FQA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MQTT-iOS-类库"><span class="toc-number">3.</span> <span class="toc-text">MQTT iOS 类库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-number">4.</span> <span class="toc-text">参考链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文档信息"><span class="toc-number">5.</span> <span class="toc-text">文档信息</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/MySQL/" title="MySQL">MySQL<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/PostgreSQL/" title="PostgreSQL">PostgreSQL<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/React-Native/" title="React Native">React Native<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>53</sup></a></li>
		  
		
		  
			<li><a href="/categories/jekyll/" title="jekyll">jekyll<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux-Unix-Centos/" title="linux &amp; Unix &amp; Centos">linux &amp; Unix &amp; Centos<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/macOS/" title="macOS">macOS<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/security/" title="security">security<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/开发工具/" title="开发工具">开发工具<sup>15</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂记/" title="杂记">杂记<sup>14</sup></a></li>
		  
		
		</ul>
</div>


  <div class="weixin">
  <br />
<!--
  <p class="asidetitle">微信打赏，赞助小猿</p>
  <p>你的支持，是对小猿的最大鼓励</p>
  <img src="/images/ads/weixin-pay.png" width="220px" />
-->
<br />
  <p class="asidetitle">欢迎关注微博</p>
  <p>微博ID：<a href="https://weibo.com/u/5166488487" target="_blank">@devhitao</a></p>
  <a href="https://weibo.com/u/5166488487" target="_blank"><img src="/images/ads/weibo.png" width="220px" /></a>
  <!-- <p class="asidetitle">iOS交流群</p> -->
  <!-- <p>Q群:326729317,暗号:小锅</p> -->
  <!-- <a href="http://jq.qq.com/?_wv=1027&k=2BjVH4c" target="_blank"><img src="/ad/place-hold.png"  width="220px" /></a> -->
<br />
<br />
  <p class="asidetitle">友情链接</p>
  <p><a href="http://www.ituring.com.cn/" target="_blank">图灵社区</a></p>
  <p><a href="http://www.ruanyifeng.com/blog/" target="_blank">阮一峰的网络日志</a></p>
  <p><a href="https://www.liaoxuefeng.com/" target="_blank">廖雪峰的官方网站</a></p>
  <!-- 
  <p>test</p>
  <a href="http://www.test.com" target="_blank"><img src="/ad/weibo.png"  width="220px" height="100"/></a>
-->
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

	<p class="copyright" style="margin-top: 10px;">
<!--cc 图标-->
<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
	&nbsp;&nbsp;&nbsp;
	Powered by <a href="https://hexo.io" target="_blank" title="hexo">Hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2021
	
	<a href="/about" target="_blank" title="郭工">郭工</a>
	
<!--	&nbsp;&nbsp;
	原创内容，保留一切权利。-->
<!--cnzz 统计图标-->
&nbsp;&nbsp;&nbsp;
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261101034'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1261101034%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
	</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>





<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-79883090-2', 'blog.devhitao.com');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?6f3ed6f7016660f2922ad49dcee905e3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
